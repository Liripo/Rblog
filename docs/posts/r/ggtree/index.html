<!DOCTYPE html>
<html lang="Zh-cn">
<head>
    <meta charset="utf-8">
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://liripo.github.io/css/frameworks.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://liripo.github.io/css/github.css" />
    
    <link crossorigin="anonymous" media="(prefers-color-scheme: dark)" rel="stylesheet"
        href="https://liripo.github.io/css/dark.css" />
    
    <meta name="viewport" content="width=device-width">
    <meta name="description"
        content="a.sourceLine { display: inline-block; line-height: 1.25; } a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; } a.sourceLine:empty { height: 1.2em; } .sourceCode { overflow: visible; } code.sourceCode { white-space: pre; position: relative; } div.sourceCode { margin: 1em 0; } pre.sourceCode { margin: 0; } @media screen { div.sourceCode { overflow: auto; } } @media print { code.sourceCode { white-space: pre-wrap; } a.sourceLine { text-indent: -1em; padding-left: 1em; } } pre.numberSource" />
    <meta name="keywords"
        content="" />
    <meta name="robots" content="noodp" />
    <link rel="canonical" href="https://liripo.github.io/posts/r/ggtree/" />

    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ggtree - Liripo" />
    <meta name="twitter:description"
        content="a.sourceLine { display: inline-block; line-height: 1.25; } a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; } a.sourceLine:empty { height: 1.2em; } .sourceCode { overflow: visible; } code.sourceCode { white-space: pre; position: relative; } div.sourceCode { margin: 1em 0; } pre.sourceCode { margin: 0; } @media screen { div.sourceCode { overflow: auto; } } @media print { code.sourceCode { white-space: pre-wrap; } a.sourceLine { text-indent: -1em; padding-left: 1em; } } pre.numberSource" />
    <meta name="twitter:site" content="https://liripo.github.io" />
    <meta name="twitter:creator" content="Liripo" />
    <meta name="twitter:image"
        content="https://liripo.github.io">

    
    <meta property="og:type" content="article" />
    <meta property="og:title" content="ggtree - Liripo">
    <meta property="og:description"
        content="a.sourceLine { display: inline-block; line-height: 1.25; } a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; } a.sourceLine:empty { height: 1.2em; } .sourceCode { overflow: visible; } code.sourceCode { white-space: pre; position: relative; } div.sourceCode { margin: 1em 0; } pre.sourceCode { margin: 0; } @media screen { div.sourceCode { overflow: auto; } } @media print { code.sourceCode { white-space: pre-wrap; } a.sourceLine { text-indent: -1em; padding-left: 1em; } } pre.numberSource" />
    <meta property="og:url" content="https://liripo.github.io/posts/r/ggtree/" />
    <meta property="og:site_name" content="ggtree" />
    <meta property="og:image"
        content="https://liripo.github.io">
    <meta property="og:image:width" content="2048">
    <meta property="og:image:height" content="1024">
    
    <meta property="article:published_time" content="2020-08-26 00:00:00 &#43;0000 UTC" />
    

    
    

    
    

    <title>ggtree - Liripo</title>

    <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://liripo.github.io/images/favicon.ico">
    <meta name="theme-color" content="#1e2327">

    
    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-155993181-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>

<body class="env-production emoji-size-boost page-responsive page-profile">
  <div class="position-relative js-header-wrapper ">
    <span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar">
        <span class="progress-pjax-loader-bar top-0 left-0" style="width: 0%;"></span>
    </span>
    <header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role="banner">
        <div class="Header-item d-none d-lg-flex">
            <a class="Header-link" href="https://liripo.github.io" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div
            class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden">
            <div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to"
                role="combobox" aria-owns="jump-to-results" aria-label="Search or jump to" aria-haspopup="listbox"
                aria-expanded="false">
                <div class="position-relative">
                </div>
            </div>
        </div>
        <nav class="d-flex" aria-label="Global">
            <a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a>
        </nav>
        <div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style="margin-right: auto;">
            <a class="Header-link" href="https://liripo.github.io" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div class="Header-item position-relative mr-0 d-none d-lg-flex">
            <details class="details-overlay details-reset">
                <summary class="Header-link" aria-label="View profile and more"
                    data-ga-click="Header, show menu, icon:avatar">
                    
                    <img alt="" class="avatar" src="https://themes.gohugo.io/theme/github-style/images/avatar.png" height="20" width="20">
                    
                </summary>
            </details>
        </div>
    </header>
</div>

<div id="start-of-content" class="show-on-focus"></div>
<div id="js-flash-container">
</div>

  
<div class="application-main " data-commit-hovercards-enabled="">
    <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode" class="">
        <main>
            <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4 ">
                <div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block">
                    <div class="mb-3 d-flex">
                        <h1 class="public css-truncate float-none flex-auto width-fit pl-0">
                            <a class="avatar mr-1" href="https://liripo.github.io/about/">
                                

                                <img src="https://themes.gohugo.io/theme/github-style/images/avatar.png" width="26" height="26">
                                
                            </a>
                            <span class="author"><a href="https://liripo.github.io">liripo</a></span>
                            <span class="path-divider">/</span>
                            <strong itemprop="name" class="css-truncate-target" style="max-width: 410px"><a
                                    href="https://liripo.github.io/posts/r/ggtree/">ggtree</a></strong>

                            <div class="d-block text-small text-gray">
                                Created <time-ago datetime="2020-08-26" class="no-wrap"
                                    title="Created at 2020/08/26">
                                    2020-08-26</time-ago>
                                <span class="file-info-divider"></span>
                                Modified <time-ago datetime="2020-08-26" class="no-wrap"
                                    title="Modified  at 2020/08/26">
                                    2020-08-26</time-ago>
                            </div>
                        </h1>
                    </div>
                </div>




            </div>
            <div class="container-lg clearfix new-discussion-timeline experiment-repo-nav  p-responsive">
                <div class="repository-content ">
                    <div class="Box mt-3 position-relative">
                        <div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center">
                            <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                                2331 Words
                                
                            </div>
                        </div>

                        <div id="readme" class="Box-body readme blob instapaper_body js-code-block-container">
                            <article class="markdown-body entry-content p-3 p-md-6" itemprop="text">
<link href="../../../rmarkdown-libs/pagedtable/css/pagedtable.css" rel="stylesheet" />
<script src="../../../rmarkdown-libs/pagedtable/js/pagedtable.js"></script>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#newick">newick</a></li>
<li><a href="#树的可视化以及数据注释">树的可视化以及数据注释</a></li>
<li><a href="#ggtree绘制层次聚类图等">ggtree绘制层次聚类图等</a></li>
<li><a href="#进化树注释">进化树注释</a></li>
<li><a href="#ggtreeextra">ggtreeExtra</a></li>
</ul>
</div>

<p><a href="http://yulab-smu.top/treedata-book/">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(ggtree)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(ape)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(treeio)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<div id="newick" class="section level1">
<h1>newick</h1>
<p><a href="https://www.megasoftware.net/">MEGA</a>支持以三种不同的格式导出树：Newick，tabular和Nexus。其中<a href="https://evolution.genetics.washington.edu/phylip/newicktree.html">newick</a>可以直接使用read.tree读取。
其中不管什么软件，都极为常用。自己尝试着写newick格式画树。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">new &lt;-<span class="st"> &quot;((A:3.0,B:4.0):2.0,(C:3.0,D:2.0):3.0,E:1.0);&quot;</span></a>
<a class="sourceLine" id="cb2-2" title="2">tree &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="dt">text =</span> new)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">ggtree</span>(tree)<span class="op">+</span><span class="kw">geom_tiplab</span>()</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-2-1.png" width="672" />
这样写的话我们会有两个值，tiplab跟edge.legnth</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">ggplot</span>(tree, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tree</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">  </span><span class="kw">geom_tiplab</span>()</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(<span class="kw">read.tree</span>(<span class="dt">text =</span> <span class="st">&quot;(B,(A,D),C);&quot;</span>))</a>
<a class="sourceLine" id="cb4-2" title="2">p2 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(<span class="kw">read.tree</span>(<span class="dt">text =</span> <span class="st">&quot;(A,(B,C),D);&quot;</span>))</a>
<a class="sourceLine" id="cb4-3" title="3">p3 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(<span class="kw">read.tree</span>(<span class="dt">text =</span> <span class="st">&quot;((A,D),(C,B));&quot;</span>))<span class="op">+</span><span class="kw">theme_tree2</span>()</a>
<a class="sourceLine" id="cb4-4" title="4">p1<span class="op">+</span>p2<span class="op">+</span>p3</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">ggtree</span>(<span class="kw">read.tree</span>(<span class="dt">text =</span> <span class="st">&quot;(B,(A,D)1,C);&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">  </span><span class="kw">geom_nodelab</span>()<span class="op">+</span><span class="kw">geom_tiplab</span>()</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>上面即添加了AD-&gt;BC的节点（node）信息。这个节点信息一般会储存bootstrap值。</p>
<p>让我们再看看root</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">rooted &lt;-<span class="st"> </span>ape<span class="op">::</span><span class="kw">root</span>(tree,<span class="dt">outgroup =</span> <span class="kw">which</span>(tree<span class="op">$</span>tip.label <span class="op">==</span><span class="st"> &quot;D&quot;</span>))</a>
<a class="sourceLine" id="cb6-2" title="2">ape<span class="op">:::</span><span class="kw">.write.tree2</span>(rooted,<span class="dt">check_tips =</span> T)</a></code></pre></div>
<pre><code>## [1] &quot;((((A:3,B:4):2,E:1):3,C:3):0,D:2);&quot;</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(rooted)<span class="op">+</span><span class="kw">geom_tiplab</span>()</a>
<a class="sourceLine" id="cb8-2" title="2">p2 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>()</a>
<a class="sourceLine" id="cb8-3" title="3">tree_root &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="dt">text=</span><span class="st">&#39;((((A:3,B:4):2,E:1):3,C:3):0,D:2):1;&#39;</span>)</a>
<a class="sourceLine" id="cb8-4" title="4">p3 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree_root) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_rootedge</span>()</a>
<a class="sourceLine" id="cb8-5" title="5">p1<span class="op">+</span>p2 <span class="op">+</span>p3</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-6-1.png" width="672" />
D移动到了最下面,这实际上就是有根了，当然也可以展示那种没有标签的，比如p3就是p2上修改罢了，加一个没有标签的根，但是这只是展示的方式而已（方便直观地从根开始看而已）（我觉得真正的有根树应该是在确定序列确定根后，使用那条根去计算距离等不是才对吗？）。</p>
<p>看过newick格式的各种画树，我们再看看树数据转tibble长什么样</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">ggtree</span>(tree)<span class="op">$</span>data</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["parent"],"name":[1],"type":["int"],"align":["right"]},{"label":["node"],"name":[2],"type":["int"],"align":["right"]},{"label":["branch.length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["label"],"name":[4],"type":["chr"],"align":["left"]},{"label":["isTip"],"name":[5],"type":["lgl"],"align":["right"]},{"label":["x"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["branch"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["angle"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"7","2":"1","3":"3","4":"A","5":"TRUE","6":"5","7":"2.000000","8":"3.5","9":"144"},{"1":"7","2":"2","3":"4","4":"B","5":"TRUE","6":"6","7":"3.000000","8":"4.0","9":"216"},{"1":"8","2":"3","3":"3","4":"C","5":"TRUE","6":"6","7":"4.000000","8":"4.5","9":"288"},{"1":"8","2":"4","3":"2","4":"D","5":"TRUE","6":"5","7":"5.000000","8":"4.0","9":"360"},{"1":"6","2":"5","3":"1","4":"E","5":"TRUE","6":"1","7":"1.000000","8":"0.5","9":"72"},{"1":"6","2":"6","3":"0","4":"NA","5":"FALSE","6":"0","7":"2.666667","8":"0.0","9":"192"},{"1":"6","2":"7","3":"2","4":"NA","5":"FALSE","6":"2","7":"2.500000","8":"1.0","9":"180"},{"1":"6","2":"8","3":"3","4":"NA","5":"FALSE","6":"3","7":"4.500000","8":"1.5","9":"324"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">tree <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["parent"],"name":[1],"type":["int"],"align":["right"]},{"label":["node"],"name":[2],"type":["int"],"align":["right"]},{"label":["branch.length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["label"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"7","2":"1","3":"3","4":"A"},{"1":"7","2":"2","3":"4","4":"B"},{"1":"8","2":"3","3":"3","4":"C"},{"1":"8","2":"4","3":"2","4":"D"},{"1":"6","2":"5","3":"1","4":"E"},{"1":"6","2":"6","3":"NA","4":"NA"},{"1":"6","2":"7","3":"2","4":"NA"},{"1":"6","2":"8","3":"3","4":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>可以看到两个的不同。这就是为什么可以使用<code>ggplot() + geom_tree(aes(x,y))</code>的原因的，</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> branch,<span class="dt">label =</span> branch.length))</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>这样就可以将分枝长度绘制出来了。0嘛就是</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">ape<span class="op">:::</span><span class="kw">.write.tree2</span>(tree,<span class="dt">check_tips =</span> T)</a></code></pre></div>
<pre><code>## [1] &quot;((A:3,B:4):2,(C:3,D:2):3,E:1);&quot;</code></pre>
<p>应该就是newick无根无值，ggtree自动补零,自动加根？</p>
</div>
<div id="树的可视化以及数据注释" class="section level1">
<h1>树的可视化以及数据注释</h1>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">nwk &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;sample.nwk&quot;</span>, <span class="dt">package=</span><span class="st">&quot;treeio&quot;</span>)</a>
<a class="sourceLine" id="cb14-2" title="2">tree &lt;-<span class="st"> </span><span class="kw">read.tree</span>(nwk)</a>
<a class="sourceLine" id="cb14-3" title="3">ape<span class="op">:::</span><span class="kw">.write.tree2</span>(tree,<span class="dt">check_tips =</span> T)</a></code></pre></div>
<pre><code>## [1] &quot;(((((((A:4,B:4):6,C:5):8,D:6):3,E:21):10,((F:4,G:12):14,H:8):13):13,((I:5,J:2):30,(K:11,L:11):2):17):4,M:56);&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree)</a>
<a class="sourceLine" id="cb16-2" title="2">p2 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree, <span class="dt">color=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">linetype=</span><span class="st">&quot;dotted&quot;</span>)</a>
<a class="sourceLine" id="cb16-3" title="3">p3 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree,<span class="dt">ladderize =</span> F)</a>
<a class="sourceLine" id="cb16-4" title="4">p4 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree,<span class="dt">branch.length =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb16-5" title="5">p1<span class="op">+</span>p2<span class="op">+</span>p3<span class="op">+</span>p4<span class="op">+</span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;I&quot;</span>)</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>ladderize不以梯形呈现树，branch.length可以只展示树的拓扑结构。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">layouts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;rectangular&quot;</span>, <span class="st">&quot;slanted&quot;</span>, <span class="st">&quot;fan&quot;</span>, <span class="st">&quot;circular&quot;</span>, <span class="st">&quot;radial&quot;</span>, <span class="st">&quot;unrooted&quot;</span>, <span class="st">&quot;equal_angle&quot;</span>, <span class="st">&quot;daylight&quot;</span>, <span class="st">&quot;ape&quot;</span>)</a>
<a class="sourceLine" id="cb17-2" title="2">plots &lt;-<span class="st"> </span><span class="kw">map</span>(layouts,<span class="op">~</span><span class="kw">ggtree</span>(<span class="dt">tr =</span> tree,<span class="dt">layout =</span> .x))</a></code></pre></div>
<pre><code>## Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will
## replace the existing scale.</code></pre>
<pre><code>## &quot;daylight&quot; method was used as default layout for unrooted tree.</code></pre>
<pre><code>## Average angle change [1] 0.161786714463209</code></pre>
<pre><code>## Average angle change [2] 0.050721258810625</code></pre>
<pre><code>## Average angle change [3] 0.0238174251191971</code></pre>
<pre><code>## Average angle change [1] 0.161786714463209</code></pre>
<pre><code>## Average angle change [2] 0.050721258810625</code></pre>
<pre><code>## Average angle change [3] 0.0238174251191971</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="kw">wrap_plots</span>(plots) <span class="op">+</span><span class="st"> </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">plot_layout</span>(<span class="dt">ncol =</span> <span class="dv">3</span>,<span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>更具体的看<a href="http://yulab-smu.top/treedata-book/chapter4.html">http://yulab-smu.top/treedata-book/chapter4.html</a></p>
<blockquote>
<p>查看选定的树枝及缩放选定树枝</p>
</blockquote>
<p>我觉得有时候这是有必要的。</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_nodelab</span>(<span class="kw">aes</span>(<span class="dt">label =</span> node))</a>
<a class="sourceLine" id="cb27-2" title="2">p2 &lt;-<span class="st"> </span><span class="kw">viewClade</span>(p1, <span class="kw">MRCA</span>(p1, <span class="st">&quot;I&quot;</span>, <span class="st">&quot;L&quot;</span>))</a>
<a class="sourceLine" id="cb27-3" title="3">p3 &lt;-<span class="st"> </span><span class="kw">scaleClade</span>(p1, <span class="dt">node=</span><span class="dv">17</span>, <span class="dt">scale=</span>.<span class="dv">1</span>) </a>
<a class="sourceLine" id="cb27-4" title="4">p1<span class="op">+</span>p2 <span class="op">+</span>p3 <span class="op">+</span><span class="st"> </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;I&quot;</span>)</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<blockquote>
<p>折叠与展开</p>
</blockquote>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">p4 &lt;-<span class="st"> </span>p1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collapse</span>(<span class="dt">node=</span><span class="dv">21</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-2" title="2"><span class="st">  </span><span class="kw">geom_point2</span>(<span class="kw">aes</span>(<span class="dt">subset=</span>(node<span class="op">==</span><span class="dv">21</span>)), <span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">size=</span><span class="dv">5</span>, <span class="dt">fill=</span><span class="st">&#39;green&#39;</span>)</a>
<a class="sourceLine" id="cb28-3" title="3">p5 &lt;-<span class="st"> </span><span class="kw">collapse</span>(p4, <span class="dt">node=</span><span class="dv">23</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-4" title="4"><span class="st">  </span><span class="kw">geom_point2</span>(<span class="kw">aes</span>(<span class="dt">subset=</span>(node<span class="op">==</span><span class="dv">23</span>)), <span class="dt">shape=</span><span class="dv">23</span>, <span class="dt">size=</span><span class="dv">5</span>, <span class="dt">fill=</span><span class="st">&#39;red&#39;</span>)</a>
<a class="sourceLine" id="cb28-5" title="5">p6 &lt;-<span class="st"> </span>ggtree<span class="op">::</span><span class="kw">expand</span>(p5, <span class="dt">node=</span><span class="dv">23</span>) <span class="op">%&gt;%</span><span class="st"> </span>ggtree<span class="op">::</span><span class="kw">expand</span>(<span class="dt">node=</span><span class="dv">21</span>)</a>
<a class="sourceLine" id="cb28-6" title="6">p5<span class="op">+</span>p6</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<blockquote>
<p>open_tree和rotate_tree就不展示了。</p>
</blockquote>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">getNamespaceExports</span>(<span class="dt">ns =</span> <span class="st">&quot;ggtree&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</a></code></pre></div>
<pre><code>## Warning in matrix(., ncol = 4): 数据长度[109]不是矩阵行数[28]的整倍</code></pre>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["V1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["V2"],"name":[2],"type":["chr"],"align":["left"]},{"label":["V3"],"name":[3],"type":["chr"],"align":["left"]},{"label":["V4"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"geom_rootpoint","2":"unit","3":"geom_tippoint","4":"geom_highlight"},{"1":"layout_rectangular","2":"layout_dendrogram","3":"geom_tiplab","4":"ggsave"},{"1":"geom_text","2":"gzoom","3":"theme_tree2","4":"arrow"},{"1":"geom_tree","2":"decimal2Date","3":"guide_legend","4":"nodepie"},{"1":"ggdensitree","2":"geom_nodelab","3":"nodelab","4":"rotate"},{"1":"groupOTU","2":"geom_treescale","3":"xlim","4":"geom_balance"},{"1":"fortify","2":"layout_circular","3":"facet_labeller","4":"geom_cladelabel2"},{"1":"geom_label","2":"msaplot","3":"annotation_image","4":"read.tree"},{"1":"geom_tiplab2","2":"scale_fill_manual","3":"geom_point","4":"multiplot"},{"1":"theme","2":"xlim_expand","3":"%<+%","4":"geom_label2"},{"1":"geom_aline","2":"flip","3":"scale_x_range","4":"groupClade"},{"1":"geom_strip","2":"get_clade_position","3":"ggplot","4":"GeomHilight"},{"1":"geom_segment2","2":"inset","3":"%+>%","4":"geom_rootedge"},{"1":"set_hilight_legend","2":"geom_point2","3":"geom_hilight_encircle","4":"nodebar"},{"1":"expand","2":"collapse","3":"theme_tree","4":"MRCA"},{"1":"scale_color","2":"geom_nodelab2","3":"range_format","4":"scaleClade"},{"1":".__T__gzoom:ggtree","2":"geom_taxalink","3":"geom_range","4":"scale_colour_manual"},{"1":"scale_color_manual","2":"phylopic","3":"%>%","4":"aes"},{"1":"facet_widths","2":"theme_dendrogram","3":"geom_facet","4":"StatBalance"},{"1":"viewClade","2":"margin","3":"nodeid","4":"layout_fan"},{"1":"rtree","2":"add_colorbar","3":"gheatmap","4":".__T__scale_color:ggtree"},{"1":"stat_hilight","2":"Date2decimal","3":"ggtree","4":"as.polytomy"},{"1":"get_heatmap_column_position","2":"revts","3":"theme_inset","4":"geom_text2"},{"1":"open_tree","2":"geom_nodepoint","3":"scale_x_ggtree","4":"get_taxa_name"},{"1":"xlim_tree","2":"geom_cladelabel","3":"StatHilight","4":"facet_data"},{"1":"%<%","2":"geom_inset","3":"subview","4":"geom_rootpoint"},{"1":"rotate_tree","2":"facet_plot","3":"geom_hilight","4":"layout_rectangular"},{"1":"geom_motif","2":"geom_tree2","3":"get.path","4":"geom_text"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>这是ggtree所有导出的函数。
我觉得有个函数很重要<code>%&lt;+%</code>
这函数源码为</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="st">`</span><span class="dt">%&lt;+%</span><span class="st">`</span></a></code></pre></div>
<pre><code>## function (pg, data) 
## {
##     if (!is.data.frame(data)) {
##         stop(&quot;input should be a data.frame...&quot;)
##     }
##     pg %add% data
## }
## &lt;bytecode: 0x00000000230fbbf8&gt;
## &lt;environment: namespace:ggtree&gt;</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">ggtree<span class="op">:::</span><span class="st">`</span><span class="dt">%add%</span><span class="st">`</span></a></code></pre></div>
<pre><code>## function (p, data) 
## {
##     p$data &lt;- p$data %add2% data
##     return(p)
## }
## &lt;bytecode: 0x0000000021de44c8&gt;
## &lt;environment: namespace:ggtree&gt;</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">ggtree<span class="op">:::</span><span class="st">`</span><span class="dt">%add2%</span><span class="st">`</span></a></code></pre></div>
<pre><code>## function (d1, d2) 
## {
##     if (&quot;node&quot; %in% colnames(d2)) {
##         cn &lt;- colnames(d2)
##         ii &lt;- which(cn %in% c(&quot;node&quot;, cn[!cn %in% colnames(d1)]))
##         d2 &lt;- d2[, ii]
##         dd &lt;- dplyr::left_join(d1, d2, by = &quot;node&quot;)
##     }
##     else {
##         d2[, 1] &lt;- as.character(unlist(d2[, 1]))
##         d2 &lt;- dplyr::rename(d2, label = 1)
##         dd &lt;- dplyr::left_join(d1, d2, by = &quot;label&quot;)
##     }
##     dd &lt;- dd[match(d1$node, dd$node), ]
##     return(dd)
## }
## &lt;bytecode: 0x000000001bb49ff0&gt;
## &lt;environment: namespace:ggtree&gt;</code></pre>
<p>将<code>left_join</code>函数封装起来了，使得我们可以轻易的在绘图时使用。
这个函数在<a href="http://yulab-smu.top/treedata-book/chapter7.html">http://yulab-smu.top/treedata-book/chapter7.html</a>有讲到。
方便我们将绘图数据加入到绘图中</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1">info &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">tip =</span> tree<span class="op">$</span>tip.label,<span class="dt">group =</span> <span class="kw">cut_interval</span>(<span class="kw">seq_along</span>(tree<span class="op">$</span>tip.label),<span class="dt">n =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb38-2" title="2"><span class="kw">ggtree</span>(tree)<span class="op">%&lt;+%</span>info <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color =</span> group))</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree)<span class="op">%&lt;+%</span>info</a>
<a class="sourceLine" id="cb39-2" title="2">p<span class="op">$</span>data</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["parent"],"name":[1],"type":["int"],"align":["right"]},{"label":["node"],"name":[2],"type":["int"],"align":["right"]},{"label":["branch.length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["label"],"name":[4],"type":["chr"],"align":["left"]},{"label":["isTip"],"name":[5],"type":["lgl"],"align":["right"]},{"label":["x"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["branch"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["angle"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[10],"type":["fctr"],"align":["left"]}],"data":[{"1":"20","2":"1","3":"4","4":"A","5":"TRUE","6":"48","7":"12.000000","8":"46.0","9":"332.30769","10":"[1,5]"},{"1":"20","2":"2","3":"4","4":"B","5":"TRUE","6":"48","7":"13.000000","8":"46.0","9":"360.00000","10":"[1,5]"},{"1":"19","2":"3","3":"5","4":"C","5":"TRUE","6":"43","7":"11.000000","8":"40.5","9":"304.61538","10":"[1,5]"},{"1":"18","2":"4","3":"6","4":"D","5":"TRUE","6":"36","7":"10.000000","8":"33.0","9":"276.92308","10":"[1,5]"},{"1":"17","2":"5","3":"21","4":"E","5":"TRUE","6":"48","7":"9.000000","8":"37.5","9":"249.23077","10":"[1,5]"},{"1":"22","2":"6","3":"4","4":"F","5":"TRUE","6":"48","7":"7.000000","8":"46.0","9":"193.84615","10":"(5,9]"},{"1":"22","2":"7","3":"12","4":"G","5":"TRUE","6":"56","7":"8.000000","8":"50.0","9":"221.53846","10":"(5,9]"},{"1":"21","2":"8","3":"8","4":"H","5":"TRUE","6":"38","7":"6.000000","8":"34.0","9":"166.15385","10":"(5,9]"},{"1":"24","2":"9","3":"5","4":"I","5":"TRUE","6":"56","7":"2.000000","8":"53.5","9":"55.38462","10":"(5,9]"},{"1":"24","2":"10","3":"2","4":"J","5":"TRUE","6":"53","7":"3.000000","8":"52.0","9":"83.07692","10":"(9,13]"},{"1":"25","2":"11","3":"11","4":"K","5":"TRUE","6":"34","7":"4.000000","8":"28.5","9":"110.76923","10":"(9,13]"},{"1":"25","2":"12","3":"11","4":"L","5":"TRUE","6":"34","7":"5.000000","8":"28.5","9":"138.46154","10":"(9,13]"},{"1":"14","2":"13","3":"56","4":"M","5":"TRUE","6":"56","7":"1.000000","8":"28.0","9":"27.69231","10":"(9,13]"},{"1":"14","2":"14","3":"0","4":"NA","5":"FALSE","6":"0","7":"3.460938","8":"0.0","9":"95.84135","10":"NA"},{"1":"14","2":"15","3":"4","4":"NA","5":"FALSE","6":"4","7":"5.921875","8":"2.0","9":"163.99038","10":"NA"},{"1":"15","2":"16","3":"13","4":"NA","5":"FALSE","6":"17","7":"8.343750","8":"10.5","9":"231.05769","10":"NA"},{"1":"16","2":"17","3":"10","4":"NA","5":"FALSE","6":"27","7":"9.937500","8":"22.0","9":"275.19231","10":"NA"},{"1":"17","2":"18","3":"3","4":"NA","5":"FALSE","6":"30","7":"10.875000","8":"28.5","9":"301.15385","10":"NA"},{"1":"18","2":"19","3":"8","4":"NA","5":"FALSE","6":"38","7":"11.750000","8":"34.0","9":"325.38462","10":"NA"},{"1":"19","2":"20","3":"6","4":"NA","5":"FALSE","6":"44","7":"12.500000","8":"41.0","9":"346.15385","10":"NA"},{"1":"16","2":"21","3":"13","4":"NA","5":"FALSE","6":"30","7":"6.750000","8":"23.5","9":"186.92308","10":"NA"},{"1":"21","2":"22","3":"14","4":"NA","5":"FALSE","6":"44","7":"7.500000","8":"37.0","9":"207.69231","10":"NA"},{"1":"15","2":"23","3":"17","4":"NA","5":"FALSE","6":"21","7":"3.500000","8":"12.5","9":"96.92308","10":"NA"},{"1":"23","2":"24","3":"30","4":"NA","5":"FALSE","6":"51","7":"2.500000","8":"36.0","9":"69.23077","10":"NA"},{"1":"23","2":"25","3":"2","4":"NA","5":"FALSE","6":"23","7":"4.500000","8":"22.0","9":"124.61538","10":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="ggtree绘制层次聚类图等" class="section level1">
<h1>ggtree绘制层次聚类图等</h1>
<p>具体的看<a href="http://yulab-smu.top/treedata-book/chapter9.html">http://yulab-smu.top/treedata-book/chapter9.html</a></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">hc &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(mtcars))</a>
<a class="sourceLine" id="cb40-2" title="2">hc</a></code></pre></div>
<pre><code>## 
## Call:
## hclust(d = dist(mtcars))
## 
## Cluster method   : complete 
## Distance         : euclidean 
## Number of objects: 32</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">den &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc)</a>
<a class="sourceLine" id="cb42-2" title="2">den</a></code></pre></div>
<pre><code>## &#39;dendrogram&#39; with 2 branches and 32 members total, at height 425.3447</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1">clus &lt;-<span class="st"> </span><span class="kw">cutree</span>(hc, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb44-2" title="2">clus</a></code></pre></div>
<pre><code>##           Mazda RX4       Mazda RX4 Wag          Datsun 710      Hornet 4 Drive 
##                   1                   1                   1                   2 
##   Hornet Sportabout             Valiant          Duster 360           Merc 240D 
##                   3                   2                   3                   1 
##            Merc 230            Merc 280           Merc 280C          Merc 450SE 
##                   1                   1                   1                   2 
##          Merc 450SL         Merc 450SLC  Cadillac Fleetwood Lincoln Continental 
##                   2                   2                   3                   3 
##   Chrysler Imperial            Fiat 128         Honda Civic      Toyota Corolla 
##                   3                   1                   1                   1 
##       Toyota Corona    Dodge Challenger         AMC Javelin          Camaro Z28 
##                   1                   2                   2                   3 
##    Pontiac Firebird           Fiat X1-9       Porsche 914-2        Lotus Europa 
##                   3                   1                   1                   1 
##      Ford Pantera L        Ferrari Dino       Maserati Bora          Volvo 142E 
##                   3                   1                   4                   1</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">g &lt;-<span class="st"> </span><span class="kw">split</span>(<span class="kw">names</span>(clus), clus)</a>
<a class="sourceLine" id="cb46-2" title="2">p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(hc, <span class="dt">linetype=</span><span class="st">&#39;dashed&#39;</span>)</a>
<a class="sourceLine" id="cb46-3" title="3">clades &lt;-<span class="st"> </span><span class="kw">sapply</span>(g, <span class="cf">function</span>(n) <span class="kw">MRCA</span>(p, n))</a>
<a class="sourceLine" id="cb46-4" title="4">d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">label =</span> <span class="kw">names</span>(clus), </a>
<a class="sourceLine" id="cb46-5" title="5">                <span class="dt">cyl =</span> mtcars[<span class="kw">names</span>(clus), <span class="st">&quot;cyl&quot;</span>])</a>
<a class="sourceLine" id="cb46-6" title="6">p &lt;-<span class="st"> </span><span class="kw">groupClade</span>(p, clades, <span class="dt">group_name=</span><span class="st">&#39;subtree&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">color=</span>subtree)</a>
<a class="sourceLine" id="cb46-7" title="7">p <span class="op">%&lt;+%</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-8" title="8"><span class="st">  </span><span class="kw">layout_dendrogram</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-9" title="9"><span class="st">  </span><span class="kw">geom_tippoint</span>(<span class="dt">size=</span><span class="dv">5</span>, <span class="dt">shape=</span><span class="dv">21</span>, <span class="kw">aes</span>(<span class="dt">fill=</span><span class="kw">factor</span>(cyl), <span class="dt">x=</span>x<span class="fl">+.5</span>), <span class="dt">color=</span><span class="st">&#39;black&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-10" title="10"><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">label=</span>cyl), <span class="dt">size=</span><span class="dv">3</span>, <span class="dt">hjust=</span>.<span class="dv">5</span>, <span class="dt">color=</span><span class="st">&#39;black&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-11" title="11"><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">hjust=</span><span class="dv">1</span>, <span class="dt">offset=</span><span class="op">-</span><span class="dv">10</span>, <span class="dt">show.legend=</span>F) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-12" title="12"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette=</span><span class="st">&#39;Set1&#39;</span>, <span class="dt">breaks=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-13" title="13"><span class="st">  </span><span class="kw">theme_dendrogram</span>(<span class="dt">plot.margin=</span><span class="kw">margin</span>(<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">80</span>,<span class="dv">6</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-14" title="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="kw">c</span>(.<span class="dv">9</span>, <span class="fl">.6</span>))</a></code></pre></div>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-18-1.png" width="672" />
其中MRCA返回所输入的tip.label向量的最近的节点,可以直接传入列表。即找到一组节点的祖先节点。
这个代码是treedata-book的代码，基本将层次树图的方方面面都讲到了。既然展示了groupClade，那就再试下groupOut</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">group &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;aa&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(aa,cyl) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">split</span>(.<span class="op">$</span>cyl)</a>
<a class="sourceLine" id="cb47-2" title="2">group &lt;-<span class="st"> </span><span class="kw">map</span>(group,<span class="op">~</span>.x[,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb47-3" title="3">p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(hc)</a>
<a class="sourceLine" id="cb47-4" title="4"><span class="kw">groupOTU</span>(p,group)<span class="op">+</span></a>
<a class="sourceLine" id="cb47-5" title="5"><span class="st">  </span><span class="kw">aes</span>(<span class="dt">color =</span> group) <span class="op">+</span></a>
<a class="sourceLine" id="cb47-6" title="6"><span class="st">  </span><span class="kw">layout_dendrogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb47-7" title="7"><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">hjust=</span><span class="dv">1</span>, <span class="dt">offset=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">show.legend=</span>F)<span class="op">+</span></a>
<a class="sourceLine" id="cb47-8" title="8"><span class="st">  </span><span class="kw">theme_dendrogram</span>(<span class="dt">plot.margin=</span><span class="kw">margin</span>(<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">80</span>,<span class="dv">6</span>))</a></code></pre></div>
<pre><code>## Warning: `filter_()` is deprecated as of dplyr 0.7.0.
## Please use `filter()` instead.
## See vignette(&#39;programming&#39;) for more help
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<p><img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="进化树注释" class="section level1">
<h1>进化树注释</h1>
<ul>
<li>geom_cladelabel 【用于标记进化枝】</li>
<li>geom_strip 【用于某两个tip间标记】</li>
<li>geom_hilight 【高亮分支】</li>
<li>geom_balance 【突出某个节点两个直接后代分支】</li>
<li>geom_taxalink 【分类单元连结】</li>
<li>geom_range 【显示置信区间】</li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">text &lt;-<span class="st"> &quot;(((((((((A1:0.00012831,A2:0.00010735)0.8130:0.00014485,A3:5.715e-05)0.5010:1.31e-05,A4:0.00022247)0.8490:4.053e-05,A5:9.82e-06)0.9970:0.00017401,(A6:0.00079318,(A7:0.00028724,(A8:0.00011095,A9:5.717e-05)0.6770:8.273e-05)1.0000:0.00041883)1.0000:0.00269228)0.9930:8.471e-05,A10:1.415e-05)0.9940:0.00010982,A11:0.00012538)0.5100:8.467e-05,((A12:1e-07,A13:0)1.0000:6.308e-05,(A14:1.17e-06,(A15:0.00023437,(A16:6.695e-05,A17:0.0001348)0.6060:1.07e-06)0.5940:3.211e-05)1.0000:0.00024049)0.6400:0.00017276)0.9980:8.37e-05,A18:6.729e-05,A19:0);&quot;</span></a>
<a class="sourceLine" id="cb49-2" title="2">tree &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="dt">text =</span> text)</a>
<a class="sourceLine" id="cb49-3" title="3">p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_nodelab</span>(<span class="kw">aes</span>(<span class="dt">label =</span> node)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>()</a>
<a class="sourceLine" id="cb49-4" title="4">p2 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb49-5" title="5"><span class="st">  </span><span class="kw">geom_cladelabel</span>(<span class="dt">node =</span> <span class="dv">35</span>,<span class="dt">offset =</span> <span class="fl">.0001</span>,<span class="dt">label =</span> <span class="st">&quot;mg&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb49-6" title="6"><span class="st">  </span><span class="kw">geom_cladelabel</span>(<span class="dt">node =</span> <span class="dv">29</span>,<span class="dt">align =</span> T,<span class="dt">barsize =</span> <span class="dv">3</span>,<span class="dt">geom =</span> <span class="st">&quot;label&quot;</span>,<span class="dt">label =</span> <span class="st">&quot;gg&quot;</span>)</a>
<a class="sourceLine" id="cb49-7" title="7">p3 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb49-8" title="8"><span class="st">  </span><span class="kw">geom_strip</span>(<span class="st">&quot;A13&quot;</span>,<span class="st">&quot;A18&quot;</span>,<span class="dt">label=</span> <span class="st">&quot;13-18&quot;</span>,<span class="dt">offset.text=</span><span class="dv">0</span>,<span class="dt">offset =</span> <span class="fl">-0.0035</span>)</a>
<a class="sourceLine" id="cb49-9" title="9">p4 &lt;-<span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span><span class="kw">geom_hilight</span>(<span class="dt">node =</span> <span class="dv">29</span>,<span class="dt">fill=</span><span class="st">&#39;darkgreen&#39;</span>)</a>
<a class="sourceLine" id="cb49-10" title="10">p5 &lt;-<span class="st"> </span>p4 <span class="op">+</span><span class="st"> </span><span class="kw">geom_balance</span>(<span class="dt">node=</span><span class="dv">35</span>, <span class="dt">fill=</span><span class="st">&#39;steelblue&#39;</span>, <span class="dt">color=</span><span class="st">&#39;white&#39;</span>, <span class="dt">alpha=</span><span class="fl">0.6</span>)</a>
<a class="sourceLine" id="cb49-11" title="11">p6 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree, <span class="dt">layout=</span><span class="st">&quot;ape&quot;</span>)<span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>(<span class="dt">hjust =</span> <span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb49-12" title="12"><span class="st">  </span><span class="kw">geom_taxalink</span>(<span class="dt">taxa1=</span><span class="st">&#39;A13&#39;</span>, <span class="dt">taxa2=</span><span class="st">&#39;A18&#39;</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.5</span>, </a>
<a class="sourceLine" id="cb49-13" title="13">              <span class="dt">outward=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Warning: Ignoring unknown parameters: outward</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">p1<span class="op">+</span>p2<span class="op">+</span>p3<span class="op">+</span>p4<span class="op">+</span>p5<span class="op">+</span>p6 <span class="op">+</span><span class="st"> </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;I&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb51-2" title="2"><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">ncol =</span> <span class="dv">2</span>,<span class="dt">heights =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-20"></span>
<img src="../../../posts/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-20-1.svg" alt="capthion" width="1728" />
<p class="caption">
Figure 1: capthion
</p>
</div>
<p>ggtree还有拼图，分面图，图像注释这些。其中我很感兴趣的是ggmsa这个多序列拼图。</p>
</div>
<div id="ggtreeextra" class="section level1">
<h1>ggtreeExtra</h1>
</div>
</article>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<div class="utterances"></div>

<script>
    var systemThemeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    var systemTheme = systemThemeMediaQuery.matches ? 'dark' : 'light';
    var utterancesTheme = systemTheme === 'dark' ? 'github-dark' : 'github-light';
    var utterancesScript = document.createElement('script');
    utterancesScript.src = 'https://utteranc.es/client.js';
    utterancesScript.setAttribute('repo', 'liripo\/liripo.github.io');
    utterancesScript.setAttribute('issue-term', 'title');
    utterancesScript.setAttribute('theme', utterancesTheme);
    utterancesScript.setAttribute('crossorigin', 'anonymous');
    utterancesScript.setAttribute('async', '');
    document.querySelector('.utterances').appendChild(utterancesScript);
</script>
<noscript>Please enable JavaScript to view the comments</noscript>


  <div class="footer container-lg width-full p-responsive" role="contentinfo">
    <div
        class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
            <li class="mr-3 mr-lg-0">Liripo</a></li>
        </ul>

        <a aria-label="Homepage" title="Liripo" class="footer-octicon d-none d-lg-block mx-lg-4"
            href="https://liripo.github.io">
            <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24"
                aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
        </a>
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
        </ul>
    </div>
    <div class="d-flex flex-justify-center pb-6">
        <span class="f6 text-gray-light"></span>
    </div>
</div>

<script crossorigin="anonymous"
    type="application/javascript" src="https://liripo.github.io/js/frameworks.js"></script>

<script crossorigin="anonymous"
    type="application/javascript" src="https://liripo.github.io/js/github-bootstrap.js"></script>
<script src="https://liripo.github.io/js/stop.js"></script>
<script src="https://liripo.github.io/js/contributions.js"></script>

</body>

</html>