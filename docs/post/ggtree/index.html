<!DOCTYPE html>
<html lang="Zh-cn">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ggtree | Liripo</title>
    <link rel="shortcut icon" href="../../image/title.svg" type="image/x-icon">
  <script src="../../fontawesome-free-5.11.2-web/fontawesome-free-5.11.2-web/js/all.js" crossorigin="anonymous"></script>

  <style>
  	:root {
  		--pagecolour: #333333;
  		--maintext: #dddddd;
  		--faded: #888888;
  		--highlight: #6BB0DF;
  		--lowlight: #ba68c8;
	}
  </style>
  <link rel="stylesheet" href="../../css/et_book.css" />
  <link rel="stylesheet" href="../../css/search.css" />
  <link rel="stylesheet" href="../../css/style.css" />
  <link rel="alternate" type="application/rss+xml" href="https://liripo.github.io/index.xml" title="Liripo">
  
  <link rel="stylesheet" href="https://fonts.loli.net/css?family=Tangerine">

  
<meta name="twitter:card" content="summary">
<meta property="og:title" content="ggtree">




</head>


  <body>
    



    <div class="main-content">
      <nav>
  <ul class="menu">
    
    <li><a href="../../">Home</a></li>
    
    <li><a href="../../about/">About</a></li>
    
    <li><a href="../../post/">Posts</a></li>
    
    <li><a href="../../tags/">Tags</a></li>
    
  </ul>
</nav>

      <div>
  <h1>ggtree</h1>
  <h3>
    26 Aug 2020
  </h3>
   <h5 id="wc">2282 Words|Read in about 5       Min|本文总阅读量<span id="busuanzi_value_page_pv"></span>次</h5>
    </h5>
  <br><br>
</div>


      <main>
        

        
<script src="../../rmarkdown-libs/accessible-code-block/empty-anchor.js"></script>
<link href="../../rmarkdown-libs/pagedtable/css/pagedtable.css" rel="stylesheet" />
<script src="../../rmarkdown-libs/pagedtable/js/pagedtable.js"></script>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>

<aside>
<div id='anchors-navbar'>
<i class='fas fa-anchor'></i>
<div id="TOC">
<ul>
<li><a href="#newick">newick</a></li>
<li><a href="#树的可视化以及数据注释">树的可视化以及数据注释</a></li>
<li><a href="#ggtree绘制层次聚类图等">ggtree绘制层次聚类图等</a></li>
<li><a href="#进化树注释">进化树注释</a></li>
<li><a href="#ggtreeextra">ggtreeExtra</a></li>
</ul>
</div>
</div>
</aside>

<p><a href="http://yulab-smu.top/treedata-book/">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(ggtree)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(ape)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(treeio)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(patchwork)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<div id="newick" class="section level1">
<h1>newick</h1>
<p><a href="https://www.megasoftware.net/">MEGA</a>支持以三种不同的格式导出树：Newick，tabular和Nexus。其中<a href="https://evolution.genetics.washington.edu/phylip/newicktree.html">newick</a>可以直接使用read.tree读取。
其中不管什么软件，都极为常用。自己尝试着写newick格式画树。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>new &lt;-<span class="st"> &quot;((A:3.0,B:4.0):2.0,(C:3.0,D:2.0):3.0,E:1.0);&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>tree &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="dt">text =</span> new)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">ggtree</span>(tree)<span class="op">+</span><span class="kw">geom_tiplab</span>()</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-2-1.png" width="672" />
这样写的话我们会有两个值，tiplab跟edge.legnth</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">ggplot</span>(tree, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tree</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span><span class="kw">geom_tiplab</span>()</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(<span class="kw">read.tree</span>(<span class="dt">text =</span> <span class="st">&quot;(B,(A,D),C);&quot;</span>))</span>
<span id="cb4-2"><a href="#cb4-2"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(<span class="kw">read.tree</span>(<span class="dt">text =</span> <span class="st">&quot;(A,(B,C),D);&quot;</span>))</span>
<span id="cb4-3"><a href="#cb4-3"></a>p3 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(<span class="kw">read.tree</span>(<span class="dt">text =</span> <span class="st">&quot;((A,D),(C,B));&quot;</span>))<span class="op">+</span><span class="kw">theme_tree2</span>()</span>
<span id="cb4-4"><a href="#cb4-4"></a>p1<span class="op">+</span>p2<span class="op">+</span>p3</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">ggtree</span>(<span class="kw">read.tree</span>(<span class="dt">text =</span> <span class="st">&quot;(B,(A,D)1,C);&quot;</span>)) <span class="op">+</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span><span class="kw">geom_nodelab</span>()<span class="op">+</span><span class="kw">geom_tiplab</span>()</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>上面即添加了AD-&gt;BC的节点（node）信息。这个节点信息一般会储存bootstrap值。</p>
<p>让我们再看看root</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>rooted &lt;-<span class="st"> </span>ape<span class="op">::</span><span class="kw">root</span>(tree,<span class="dt">outgroup =</span> <span class="kw">which</span>(tree<span class="op">$</span>tip.label <span class="op">==</span><span class="st"> &quot;D&quot;</span>))</span>
<span id="cb6-2"><a href="#cb6-2"></a>ape<span class="op">:::</span><span class="kw">.write.tree2</span>(rooted,<span class="dt">check_tips =</span> T)</span></code></pre></div>
<pre><code>## [1] &quot;((((A:3,B:4):2,E:1):3,C:3):0,D:2);&quot;</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(rooted)<span class="op">+</span><span class="kw">geom_tiplab</span>()</span>
<span id="cb8-2"><a href="#cb8-2"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>()</span>
<span id="cb8-3"><a href="#cb8-3"></a>tree_root &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="dt">text=</span><span class="st">&#39;((((A:3,B:4):2,E:1):3,C:3):0,D:2):1;&#39;</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a>p3 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree_root) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_rootedge</span>()</span>
<span id="cb8-5"><a href="#cb8-5"></a>p1<span class="op">+</span>p2 <span class="op">+</span>p3</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-6-1.png" width="672" />
D移动到了最下面,这实际上就是有根了，当然也可以展示那种没有标签的，比如p3就是p2上修改罢了，加一个没有标签的根，但是这只是展示的方式而已（方便直观地从根开始看而已）（我觉得真正的有根树应该是在确定序列确定根后，使用那条根去计算距离等不是才对吗？）。</p>
<p>看过newick格式的各种画树，我们再看看树数据转tibble长什么样</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">ggtree</span>(tree)<span class="op">$</span>data</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["parent"],"name":[1],"type":["int"],"align":["right"]},{"label":["node"],"name":[2],"type":["int"],"align":["right"]},{"label":["branch.length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["label"],"name":[4],"type":["chr"],"align":["left"]},{"label":["isTip"],"name":[5],"type":["lgl"],"align":["right"]},{"label":["x"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["branch"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["angle"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"7","2":"1","3":"3","4":"A","5":"TRUE","6":"5","7":"2.000000","8":"3.5","9":"144"},{"1":"7","2":"2","3":"4","4":"B","5":"TRUE","6":"6","7":"3.000000","8":"4.0","9":"216"},{"1":"8","2":"3","3":"3","4":"C","5":"TRUE","6":"6","7":"4.000000","8":"4.5","9":"288"},{"1":"8","2":"4","3":"2","4":"D","5":"TRUE","6":"5","7":"5.000000","8":"4.0","9":"360"},{"1":"6","2":"5","3":"1","4":"E","5":"TRUE","6":"1","7":"1.000000","8":"0.5","9":"72"},{"1":"6","2":"6","3":"0","4":"NA","5":"FALSE","6":"0","7":"2.666667","8":"0.0","9":"192"},{"1":"6","2":"7","3":"2","4":"NA","5":"FALSE","6":"2","7":"2.500000","8":"1.0","9":"180"},{"1":"6","2":"8","3":"3","4":"NA","5":"FALSE","6":"3","7":"4.500000","8":"1.5","9":"324"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>tree <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["parent"],"name":[1],"type":["int"],"align":["right"]},{"label":["node"],"name":[2],"type":["int"],"align":["right"]},{"label":["branch.length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["label"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"7","2":"1","3":"3","4":"A"},{"1":"7","2":"2","3":"4","4":"B"},{"1":"8","2":"3","3":"3","4":"C"},{"1":"8","2":"4","3":"2","4":"D"},{"1":"6","2":"5","3":"1","4":"E"},{"1":"6","2":"6","3":"NA","4":"NA"},{"1":"6","2":"7","3":"2","4":"NA"},{"1":"6","2":"8","3":"3","4":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>可以看到两个的不同。这就是为什么可以使用<code>ggplot() + geom_tree(aes(x,y))</code>的原因的，</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x =</span> branch,<span class="dt">label =</span> branch.length))</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>这样就可以将分枝长度绘制出来了。0嘛就是</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>ape<span class="op">:::</span><span class="kw">.write.tree2</span>(tree,<span class="dt">check_tips =</span> T)</span></code></pre></div>
<pre><code>## [1] &quot;((A:3,B:4):2,(C:3,D:2):3,E:1);&quot;</code></pre>
<p>应该就是newick无根无值，ggtree自动补零,自动加根？</p>
</div>
<div id="树的可视化以及数据注释" class="section level1">
<h1>树的可视化以及数据注释</h1>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>nwk &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;sample.nwk&quot;</span>, <span class="dt">package=</span><span class="st">&quot;treeio&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a>tree &lt;-<span class="st"> </span><span class="kw">read.tree</span>(nwk)</span>
<span id="cb14-3"><a href="#cb14-3"></a>ape<span class="op">:::</span><span class="kw">.write.tree2</span>(tree,<span class="dt">check_tips =</span> T)</span></code></pre></div>
<pre><code>## [1] &quot;(((((((A:4,B:4):6,C:5):8,D:6):3,E:21):10,((F:4,G:12):14,H:8):13):13,((I:5,J:2):30,(K:11,L:11):2):17):4,M:56);&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree)</span>
<span id="cb16-2"><a href="#cb16-2"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree, <span class="dt">color=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">linetype=</span><span class="st">&quot;dotted&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a>p3 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree,<span class="dt">ladderize =</span> F)</span>
<span id="cb16-4"><a href="#cb16-4"></a>p4 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree,<span class="dt">branch.length =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb16-5"><a href="#cb16-5"></a>p1<span class="op">+</span>p2<span class="op">+</span>p3<span class="op">+</span>p4<span class="op">+</span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;I&quot;</span>)</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>ladderize不以梯形呈现树，branch.length可以只展示树的拓扑结构。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>layouts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;rectangular&#39;</span>, <span class="st">&#39;dendrogram&#39;</span>, <span class="st">&#39;slanted&#39;</span>, <span class="st">&#39;fan&#39;</span>, <span class="st">&#39;circular&#39;</span>, <span class="st">&#39;inward_circular&#39;</span>, <span class="st">&#39;radial&#39;</span>, <span class="st">&#39;equal_angle&#39;</span>, <span class="st">&#39;daylight&#39;</span>,<span class="st">&#39;ape&#39;</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a>plots &lt;-<span class="st"> </span><span class="kw">map</span>(layouts,<span class="op">~</span><span class="kw">ggtree</span>(<span class="dt">tr =</span> tree,<span class="dt">layout =</span> .x))</span></code></pre></div>
<pre><code>## Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will
## replace the existing scale.</code></pre>
<pre><code>## Average angle change [1] 0.161786714463209</code></pre>
<pre><code>## Average angle change [2] 0.050721258810625</code></pre>
<pre><code>## Average angle change [3] 0.0238174251191971</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">wrap_plots</span>(plots) <span class="op">+</span><span class="st"> </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">plot_layout</span>(<span class="dt">ncol =</span> <span class="dv">3</span>,<span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>更具体的看<a href="http://yulab-smu.top/treedata-book/chapter4.html">http://yulab-smu.top/treedata-book/chapter4.html</a></p>
<blockquote>
<p>查看选定的树枝及缩放选定树枝</p>
</blockquote>
<p>我觉得有时候这是有必要的。</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_nodelab</span>(<span class="kw">aes</span>(<span class="dt">label =</span> node))</span>
<span id="cb23-2"><a href="#cb23-2"></a>p2 &lt;-<span class="st"> </span><span class="kw">viewClade</span>(p1, <span class="kw">MRCA</span>(p1, <span class="st">&quot;I&quot;</span>, <span class="st">&quot;L&quot;</span>))</span>
<span id="cb23-3"><a href="#cb23-3"></a>p3 &lt;-<span class="st"> </span><span class="kw">scaleClade</span>(p1, <span class="dt">node=</span><span class="dv">17</span>, <span class="dt">scale=</span>.<span class="dv">1</span>) </span>
<span id="cb23-4"><a href="#cb23-4"></a>p1<span class="op">+</span>p2 <span class="op">+</span>p3 <span class="op">+</span><span class="st"> </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;I&quot;</span>)</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<blockquote>
<p>折叠与展开</p>
</blockquote>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>p4 &lt;-<span class="st"> </span>p1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">collapse</span>(<span class="dt">node=</span><span class="dv">21</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="st">  </span><span class="kw">geom_point2</span>(<span class="kw">aes</span>(<span class="dt">subset=</span>(node<span class="op">==</span><span class="dv">21</span>)), <span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">size=</span><span class="dv">5</span>, <span class="dt">fill=</span><span class="st">&#39;green&#39;</span>)</span>
<span id="cb24-3"><a href="#cb24-3"></a>p5 &lt;-<span class="st"> </span><span class="kw">collapse</span>(p4, <span class="dt">node=</span><span class="dv">23</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="st">  </span><span class="kw">geom_point2</span>(<span class="kw">aes</span>(<span class="dt">subset=</span>(node<span class="op">==</span><span class="dv">23</span>)), <span class="dt">shape=</span><span class="dv">23</span>, <span class="dt">size=</span><span class="dv">5</span>, <span class="dt">fill=</span><span class="st">&#39;red&#39;</span>)</span>
<span id="cb24-5"><a href="#cb24-5"></a>p6 &lt;-<span class="st"> </span>ggtree<span class="op">::</span><span class="kw">expand</span>(p5, <span class="dt">node=</span><span class="dv">23</span>) <span class="op">%&gt;%</span><span class="st"> </span>ggtree<span class="op">::</span><span class="kw">expand</span>(<span class="dt">node=</span><span class="dv">21</span>)</span>
<span id="cb24-6"><a href="#cb24-6"></a>p5<span class="op">+</span>p6</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<blockquote>
<p>open_tree和rotate_tree就不展示了。</p>
</blockquote>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">getNamespaceExports</span>(<span class="dt">ns =</span> <span class="st">&quot;ggtree&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span></code></pre></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["V1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["V2"],"name":[2],"type":["chr"],"align":["left"]},{"label":["V3"],"name":[3],"type":["chr"],"align":["left"]},{"label":["V4"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"geom_rootpoint","2":"geom_motif","3":"facet_plot","4":"geom_highlight"},{"1":"layout_rectangular","2":"unit","3":"geom_tree2","4":"ggsave"},{"1":"geom_text","2":"layout_dendrogram","3":"geom_tippoint","4":"hexpand"},{"1":"geom_tree","2":"gzoom","3":"geom_tiplab","4":"arrow"},{"1":"ggdensitree","2":"decimal2Date","3":"theme_tree2","4":"nodepie"},{"1":"groupOTU","2":"geom_nodelab","3":"guide_legend","4":"rotate"},{"1":"fortify","2":"geom_treescale","3":"nodelab","4":"geom_balance"},{"1":"geom_label","2":"layout_circular","3":"xlim","4":"geom_cladelabel2"},{"1":"geom_tiplab2","2":"msaplot","3":"facet_labeller","4":"read.tree"},{"1":"theme","2":"scale_fill_manual","3":"geom_point","4":"multiplot"},{"1":"geom_aline","2":"xlim_expand","3":"%<+%","4":"geom_label2"},{"1":"geom_strip","2":"flip","3":"scale_x_range","4":"groupClade"},{"1":"geom_segment2","2":"get_clade_position","3":"ggplot","4":"geom_rootedge"},{"1":"set_hilight_legend","2":"inset","3":"%+>%","4":"nodebar"},{"1":"expand","2":"geom_point2","3":"range_format","4":"layout_inward_circular"},{"1":"scale_color","2":"collapse","3":"geom_range","4":"MRCA"},{"1":".__T__gzoom:ggtree","2":"geom_nodelab2","3":"%>%","4":"scaleClade"},{"1":"scale_color_manual","2":"geom_taxalink","3":"theme_tree","4":"scale_colour_manual"},{"1":"facet_widths","2":"theme_dendrogram","3":"geom_facet","4":"aes"},{"1":"viewClade","2":"margin","3":"nodeid","4":"StatBalance"},{"1":"rtree","2":"add_colorbar","3":"gheatmap","4":"layout_fan"},{"1":"get_heatmap_column_position","2":"Date2decimal","3":"ggtree","4":".__T__scale_color:ggtree"},{"1":"open_tree","2":"revts","3":"scale_x_ggtree","4":"as.polytomy"},{"1":"xlim_tree","2":"geom_nodepoint","3":"theme_inset","4":"geom_text2"},{"1":"%<%","2":"geom_cladelabel","3":"geom_hilight","4":"get_taxa_name"},{"1":"rotate_tree","2":"geom_inset","3":"get.path","4":"facet_data"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>这是ggtree所有导出的函数。
我觉得有个函数很重要<code>%&lt;+%</code>
这函数源码为</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="st">`</span><span class="dt">%&lt;+%</span><span class="st">`</span></span></code></pre></div>
<pre><code>## function (pg, data) 
## {
##     if (!is.data.frame(data)) {
##         stop(&quot;input should be a data.frame...&quot;)
##     }
##     pg %add% data
## }
## &lt;bytecode: 0x0000000019ee81b8&gt;
## &lt;environment: namespace:ggtree&gt;</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>ggtree<span class="op">:::</span><span class="st">`</span><span class="dt">%add%</span><span class="st">`</span></span></code></pre></div>
<pre><code>## function (p, data) 
## {
##     p$data &lt;- p$data %add2% data
##     return(p)
## }
## &lt;bytecode: 0x0000000019cf3ca0&gt;
## &lt;environment: namespace:ggtree&gt;</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>ggtree<span class="op">:::</span><span class="st">`</span><span class="dt">%add2%</span><span class="st">`</span></span></code></pre></div>
<pre><code>## function (d1, d2) 
## {
##     if (&quot;node&quot; %in% colnames(d2)) {
##         cn &lt;- colnames(d2)
##         ii &lt;- which(cn %in% c(&quot;node&quot;, cn[!cn %in% colnames(d1)]))
##         d2 &lt;- d2[, ii]
##         dd &lt;- dplyr::left_join(d1, d2, by = &quot;node&quot;)
##     }
##     else {
##         d2[, 1] &lt;- as.character(unlist(d2[, 1]))
##         d2 &lt;- dplyr::rename(d2, label = 1)
##         dd &lt;- dplyr::left_join(d1, d2, by = &quot;label&quot;)
##     }
##     dd &lt;- dd[match(d1$node, dd$node), ]
##     return(dd)
## }
## &lt;bytecode: 0x0000000019b2d038&gt;
## &lt;environment: namespace:ggtree&gt;</code></pre>
<p>将<code>left_join</code>函数封装起来了，使得我们可以轻易的在绘图时使用。
这个函数在<a href="http://yulab-smu.top/treedata-book/chapter7.html">http://yulab-smu.top/treedata-book/chapter7.html</a>有讲到。
方便我们将绘图数据加入到绘图中</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>info &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">tip =</span> tree<span class="op">$</span>tip.label,<span class="dt">group =</span> <span class="kw">cut_interval</span>(<span class="kw">seq_along</span>(tree<span class="op">$</span>tip.label),<span class="dt">n =</span> <span class="dv">3</span>))</span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="kw">ggtree</span>(tree)<span class="op">%&lt;+%</span>info <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color =</span> group))</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree)<span class="op">%&lt;+%</span>info</span>
<span id="cb34-2"><a href="#cb34-2"></a>p<span class="op">$</span>data</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["parent"],"name":[1],"type":["int"],"align":["right"]},{"label":["node"],"name":[2],"type":["int"],"align":["right"]},{"label":["branch.length"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["label"],"name":[4],"type":["chr"],"align":["left"]},{"label":["isTip"],"name":[5],"type":["lgl"],"align":["right"]},{"label":["x"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["branch"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["angle"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[10],"type":["fctr"],"align":["left"]}],"data":[{"1":"20","2":"1","3":"4","4":"A","5":"TRUE","6":"48","7":"12.000000","8":"46.0","9":"332.30769","10":"[1,5]"},{"1":"20","2":"2","3":"4","4":"B","5":"TRUE","6":"48","7":"13.000000","8":"46.0","9":"360.00000","10":"[1,5]"},{"1":"19","2":"3","3":"5","4":"C","5":"TRUE","6":"43","7":"11.000000","8":"40.5","9":"304.61538","10":"[1,5]"},{"1":"18","2":"4","3":"6","4":"D","5":"TRUE","6":"36","7":"10.000000","8":"33.0","9":"276.92308","10":"[1,5]"},{"1":"17","2":"5","3":"21","4":"E","5":"TRUE","6":"48","7":"9.000000","8":"37.5","9":"249.23077","10":"[1,5]"},{"1":"22","2":"6","3":"4","4":"F","5":"TRUE","6":"48","7":"7.000000","8":"46.0","9":"193.84615","10":"(5,9]"},{"1":"22","2":"7","3":"12","4":"G","5":"TRUE","6":"56","7":"8.000000","8":"50.0","9":"221.53846","10":"(5,9]"},{"1":"21","2":"8","3":"8","4":"H","5":"TRUE","6":"38","7":"6.000000","8":"34.0","9":"166.15385","10":"(5,9]"},{"1":"24","2":"9","3":"5","4":"I","5":"TRUE","6":"56","7":"2.000000","8":"53.5","9":"55.38462","10":"(5,9]"},{"1":"24","2":"10","3":"2","4":"J","5":"TRUE","6":"53","7":"3.000000","8":"52.0","9":"83.07692","10":"(9,13]"},{"1":"25","2":"11","3":"11","4":"K","5":"TRUE","6":"34","7":"4.000000","8":"28.5","9":"110.76923","10":"(9,13]"},{"1":"25","2":"12","3":"11","4":"L","5":"TRUE","6":"34","7":"5.000000","8":"28.5","9":"138.46154","10":"(9,13]"},{"1":"14","2":"13","3":"56","4":"M","5":"TRUE","6":"56","7":"1.000000","8":"28.0","9":"27.69231","10":"(9,13]"},{"1":"14","2":"14","3":"0","4":"NA","5":"FALSE","6":"0","7":"3.460938","8":"0.0","9":"95.84135","10":"NA"},{"1":"14","2":"15","3":"4","4":"NA","5":"FALSE","6":"4","7":"5.921875","8":"2.0","9":"163.99038","10":"NA"},{"1":"15","2":"16","3":"13","4":"NA","5":"FALSE","6":"17","7":"8.343750","8":"10.5","9":"231.05769","10":"NA"},{"1":"16","2":"17","3":"10","4":"NA","5":"FALSE","6":"27","7":"9.937500","8":"22.0","9":"275.19231","10":"NA"},{"1":"17","2":"18","3":"3","4":"NA","5":"FALSE","6":"30","7":"10.875000","8":"28.5","9":"301.15385","10":"NA"},{"1":"18","2":"19","3":"8","4":"NA","5":"FALSE","6":"38","7":"11.750000","8":"34.0","9":"325.38462","10":"NA"},{"1":"19","2":"20","3":"6","4":"NA","5":"FALSE","6":"44","7":"12.500000","8":"41.0","9":"346.15385","10":"NA"},{"1":"16","2":"21","3":"13","4":"NA","5":"FALSE","6":"30","7":"6.750000","8":"23.5","9":"186.92308","10":"NA"},{"1":"21","2":"22","3":"14","4":"NA","5":"FALSE","6":"44","7":"7.500000","8":"37.0","9":"207.69231","10":"NA"},{"1":"15","2":"23","3":"17","4":"NA","5":"FALSE","6":"21","7":"3.500000","8":"12.5","9":"96.92308","10":"NA"},{"1":"23","2":"24","3":"30","4":"NA","5":"FALSE","6":"51","7":"2.500000","8":"36.0","9":"69.23077","10":"NA"},{"1":"23","2":"25","3":"2","4":"NA","5":"FALSE","6":"23","7":"4.500000","8":"22.0","9":"124.61538","10":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="ggtree绘制层次聚类图等" class="section level1">
<h1>ggtree绘制层次聚类图等</h1>
<p>具体的看<a href="http://yulab-smu.top/treedata-book/chapter9.html">http://yulab-smu.top/treedata-book/chapter9.html</a></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>hc &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(mtcars))</span>
<span id="cb35-2"><a href="#cb35-2"></a>hc</span></code></pre></div>
<pre><code>## 
## Call:
## hclust(d = dist(mtcars))
## 
## Cluster method   : complete 
## Distance         : euclidean 
## Number of objects: 32</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>den &lt;-<span class="st"> </span><span class="kw">as.dendrogram</span>(hc)</span>
<span id="cb37-2"><a href="#cb37-2"></a>den</span></code></pre></div>
<pre><code>## &#39;dendrogram&#39; with 2 branches and 32 members total, at height 425.3447</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>clus &lt;-<span class="st"> </span><span class="kw">cutree</span>(hc, <span class="dv">4</span>)</span>
<span id="cb39-2"><a href="#cb39-2"></a>clus</span></code></pre></div>
<pre><code>##           Mazda RX4       Mazda RX4 Wag          Datsun 710      Hornet 4 Drive 
##                   1                   1                   1                   2 
##   Hornet Sportabout             Valiant          Duster 360           Merc 240D 
##                   3                   2                   3                   1 
##            Merc 230            Merc 280           Merc 280C          Merc 450SE 
##                   1                   1                   1                   2 
##          Merc 450SL         Merc 450SLC  Cadillac Fleetwood Lincoln Continental 
##                   2                   2                   3                   3 
##   Chrysler Imperial            Fiat 128         Honda Civic      Toyota Corolla 
##                   3                   1                   1                   1 
##       Toyota Corona    Dodge Challenger         AMC Javelin          Camaro Z28 
##                   1                   2                   2                   3 
##    Pontiac Firebird           Fiat X1-9       Porsche 914-2        Lotus Europa 
##                   3                   1                   1                   1 
##      Ford Pantera L        Ferrari Dino       Maserati Bora          Volvo 142E 
##                   3                   1                   4                   1</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>g &lt;-<span class="st"> </span><span class="kw">split</span>(<span class="kw">names</span>(clus), clus)</span>
<span id="cb41-2"><a href="#cb41-2"></a>p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(hc, <span class="dt">linetype=</span><span class="st">&#39;dashed&#39;</span>)</span>
<span id="cb41-3"><a href="#cb41-3"></a>clades &lt;-<span class="st"> </span><span class="kw">sapply</span>(g, <span class="cf">function</span>(n) <span class="kw">MRCA</span>(p, n))</span>
<span id="cb41-4"><a href="#cb41-4"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">label =</span> <span class="kw">names</span>(clus), </span>
<span id="cb41-5"><a href="#cb41-5"></a>                <span class="dt">cyl =</span> mtcars[<span class="kw">names</span>(clus), <span class="st">&quot;cyl&quot;</span>])</span>
<span id="cb41-6"><a href="#cb41-6"></a>p &lt;-<span class="st"> </span><span class="kw">groupClade</span>(p, clades, <span class="dt">group_name=</span><span class="st">&#39;subtree&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">color=</span>subtree)</span>
<span id="cb41-7"><a href="#cb41-7"></a>p <span class="op">%&lt;+%</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="st">  </span><span class="kw">layout_dendrogram</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb41-9"><a href="#cb41-9"></a><span class="st">  </span><span class="kw">geom_tippoint</span>(<span class="dt">size=</span><span class="dv">5</span>, <span class="dt">shape=</span><span class="dv">21</span>, <span class="kw">aes</span>(<span class="dt">fill=</span><span class="kw">factor</span>(cyl), <span class="dt">x=</span>x<span class="fl">+.5</span>), <span class="dt">color=</span><span class="st">&#39;black&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb41-10"><a href="#cb41-10"></a><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">label=</span>cyl), <span class="dt">size=</span><span class="dv">3</span>, <span class="dt">hjust=</span>.<span class="dv">5</span>, <span class="dt">color=</span><span class="st">&#39;black&#39;</span>) <span class="op">+</span></span>
<span id="cb41-11"><a href="#cb41-11"></a><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">hjust=</span><span class="dv">1</span>, <span class="dt">offset=</span><span class="op">-</span><span class="dv">10</span>, <span class="dt">show.legend=</span>F) <span class="op">+</span><span class="st"> </span></span>
<span id="cb41-12"><a href="#cb41-12"></a><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette=</span><span class="st">&#39;Set1&#39;</span>, <span class="dt">breaks=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">+</span></span>
<span id="cb41-13"><a href="#cb41-13"></a><span class="st">  </span><span class="kw">theme_dendrogram</span>(<span class="dt">plot.margin=</span><span class="kw">margin</span>(<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">80</span>,<span class="dv">6</span>)) <span class="op">+</span></span>
<span id="cb41-14"><a href="#cb41-14"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="kw">c</span>(.<span class="dv">9</span>, <span class="fl">.6</span>))</span></code></pre></div>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-18-1.png" width="672" />
其中MRCA返回所输入的tip.label向量的最近的节点,可以直接传入列表。即找到一组节点的祖先节点。
这个代码是treedata-book的代码，基本将层次树图的方方面面都讲到了。既然展示了groupClade，那就再试下groupOut</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>group &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;aa&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(aa,cyl) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">split</span>(.<span class="op">$</span>cyl)</span>
<span id="cb42-2"><a href="#cb42-2"></a>group &lt;-<span class="st"> </span><span class="kw">map</span>(group,<span class="op">~</span>.x[,<span class="dv">1</span>])</span>
<span id="cb42-3"><a href="#cb42-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(hc)</span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="kw">groupOTU</span>(p,group)<span class="op">+</span></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="st">  </span><span class="kw">aes</span>(<span class="dt">color =</span> group) <span class="op">+</span></span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="st">  </span><span class="kw">layout_dendrogram</span>() <span class="op">+</span></span>
<span id="cb42-7"><a href="#cb42-7"></a><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">hjust=</span><span class="dv">1</span>, <span class="dt">offset=</span><span class="op">-</span><span class="dv">1</span>, <span class="dt">show.legend=</span>F)<span class="op">+</span></span>
<span id="cb42-8"><a href="#cb42-8"></a><span class="st">  </span><span class="kw">theme_dendrogram</span>(<span class="dt">plot.margin=</span><span class="kw">margin</span>(<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">80</span>,<span class="dv">6</span>))</span></code></pre></div>
<pre><code>## Warning: `filter_()` is deprecated as of dplyr 0.7.0.
## Please use `filter()` instead.
## See vignette(&#39;programming&#39;) for more help
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<p><img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="进化树注释" class="section level1">
<h1>进化树注释</h1>
<ul>
<li>geom_cladelabel 【用于标记进化枝】</li>
<li>geom_strip 【用于某两个tip间标记】</li>
<li>geom_hilight 【高亮分支】</li>
<li>geom_balance 【突出某个节点两个直接后代分支】</li>
<li>geom_taxalink 【分类单元连结】</li>
<li>geom_range 【显示置信区间】</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>text &lt;-<span class="st"> &quot;(((((((((A1:0.00012831,A2:0.00010735)0.8130:0.00014485,A3:5.715e-05)0.5010:1.31e-05,A4:0.00022247)0.8490:4.053e-05,A5:9.82e-06)0.9970:0.00017401,(A6:0.00079318,(A7:0.00028724,(A8:0.00011095,A9:5.717e-05)0.6770:8.273e-05)1.0000:0.00041883)1.0000:0.00269228)0.9930:8.471e-05,A10:1.415e-05)0.9940:0.00010982,A11:0.00012538)0.5100:8.467e-05,((A12:1e-07,A13:0)1.0000:6.308e-05,(A14:1.17e-06,(A15:0.00023437,(A16:6.695e-05,A17:0.0001348)0.6060:1.07e-06)0.5940:3.211e-05)1.0000:0.00024049)0.6400:0.00017276)0.9980:8.37e-05,A18:6.729e-05,A19:0);&quot;</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>tree &lt;-<span class="st"> </span><span class="kw">read.tree</span>(<span class="dt">text =</span> text)</span>
<span id="cb44-3"><a href="#cb44-3"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_nodelab</span>(<span class="kw">aes</span>(<span class="dt">label =</span> node)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>()</span>
<span id="cb44-4"><a href="#cb44-4"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() <span class="op">+</span></span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="st">  </span><span class="kw">geom_cladelabel</span>(<span class="dt">node =</span> <span class="dv">35</span>,<span class="dt">offset =</span> <span class="fl">.0001</span>,<span class="dt">label =</span> <span class="st">&quot;mg&quot;</span>)<span class="op">+</span></span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="st">  </span><span class="kw">geom_cladelabel</span>(<span class="dt">node =</span> <span class="dv">29</span>,<span class="dt">align =</span> T,<span class="dt">barsize =</span> <span class="dv">3</span>,<span class="dt">geom =</span> <span class="st">&quot;label&quot;</span>,<span class="dt">label =</span> <span class="st">&quot;gg&quot;</span>)</span>
<span id="cb44-7"><a href="#cb44-7"></a>p3 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() <span class="op">+</span></span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="st">  </span><span class="kw">geom_strip</span>(<span class="st">&quot;A13&quot;</span>,<span class="st">&quot;A18&quot;</span>,<span class="dt">label=</span> <span class="st">&quot;13-18&quot;</span>,<span class="dt">offset.text=</span><span class="dv">0</span>,<span class="dt">offset =</span> <span class="fl">-0.0035</span>)</span>
<span id="cb44-9"><a href="#cb44-9"></a>p4 &lt;-<span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span><span class="kw">geom_hilight</span>(<span class="dt">node =</span> <span class="dv">29</span>,<span class="dt">fill=</span><span class="st">&#39;darkgreen&#39;</span>, <span class="dt">type=</span><span class="st">&quot;rect&quot;</span>)</span>
<span id="cb44-10"><a href="#cb44-10"></a>p5 &lt;-<span class="st"> </span>p4 <span class="op">+</span><span class="st"> </span><span class="kw">geom_balance</span>(<span class="dt">node=</span><span class="dv">35</span>, <span class="dt">fill=</span><span class="st">&#39;steelblue&#39;</span>, <span class="dt">color=</span><span class="st">&#39;white&#39;</span>, <span class="dt">alpha=</span><span class="fl">0.6</span>)</span>
<span id="cb44-11"><a href="#cb44-11"></a>p6 &lt;-<span class="st"> </span><span class="kw">ggtree</span>(tree, <span class="dt">layout=</span><span class="st">&quot;inward_circular&quot;</span>)<span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>(<span class="dt">hjust =</span> <span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb44-12"><a href="#cb44-12"></a><span class="st">  </span><span class="kw">geom_taxalink</span>(<span class="dt">taxa1=</span><span class="st">&#39;A13&#39;</span>, <span class="dt">taxa2=</span><span class="st">&#39;A18&#39;</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.5</span>, </span>
<span id="cb44-13"><a href="#cb44-13"></a>              <span class="dt">outward=</span><span class="ot">FALSE</span>)</span>
<span id="cb44-14"><a href="#cb44-14"></a>p1<span class="op">+</span>p2<span class="op">+</span>p3<span class="op">+</span>p4<span class="op">+</span>p5<span class="op">+</span>p6 <span class="op">+</span><span class="st"> </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;I&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb44-15"><a href="#cb44-15"></a><span class="st">  </span><span class="kw">plot_layout</span>(<span class="dt">ncol =</span> <span class="dv">2</span>,<span class="dt">heights =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">widths =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-20"></span>
<img src="../../post/R/2020-08-26-ggtree_files/figure-html/unnamed-chunk-20-1.svg" alt="capthion" width="1728" />
<p class="caption">
Figure 1: capthion
</p>
</div>
<p>ggtree还有拼图，分面图，图像注释这些。其中我很感兴趣的是ggmsa这个多序列拼图。</p>
</div>
<div id="ggtreeextra" class="section level1">
<h1>ggtreeExtra</h1>
</div>

      </main>

      <footer>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/r.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/python.min.js"></script>
  <script src ="/js/search.js"></script>

  <script>
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  </script>
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id       ="busuanzi_value_site_pv"></span>次</span>
  <span id="busuanzi_container_site_uv">
    本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
  
  
<script async src="../../js/center-image.js"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<center>
Liripo <SPAN id=span_dt_dt style="color: #0196e3;"></SPAN>
<SCRIPT language=javascript>
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("7/8/2019 00:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=Math.floor(e_hrsold);
e_minsold=(e_hrsold-hrsold)*60;
minsold=Math.floor((e_hrsold-hrsold)*60);
seconds=Math.floor((e_minsold-minsold)*60);
span_dt_dt.innerHTML=""+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
show_date_time();
</SCRIPT>
</center>
  
</footer>


    </div>
  </body>
</html>
