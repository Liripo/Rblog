<!DOCTYPE html>
<html lang="Zh-cn">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>samtools使用 | Liripo</title>
    <link rel="shortcut icon" href="../../image/title.svg" type="image/x-icon">
  <script src="../../fontawesome-free-5.11.2-web/fontawesome-free-5.11.2-web/js/all.js" crossorigin="anonymous"></script>

  <style>
  	:root {
  		--pagecolour: #333333;
  		--maintext: #dddddd;
  		--faded: #888888;
  		--highlight: #6BB0DF;
  		--lowlight: #ba68c8;
	}
  </style>
  <link rel="stylesheet" href="../../css/et_book.css" />
  <link rel="stylesheet" href="../../css/search.css" />
  <link rel="stylesheet" href="../../css/style.css" />
  <link rel="alternate" type="application/rss+xml" href="https://liripo.github.io/index.xml" title="Liripo">
  
  <link rel="stylesheet" href="https://fonts.loli.net/css?family=Tangerine">

  
<meta name="twitter:card" content="summary">
<meta property="og:title" content="samtools使用">




</head>


  <body>
    



    <div class="main-content">
      <nav>
  <ul class="menu">
    
    <li><a href="../../">Home</a></li>
    
    <li><a href="../../about/">About</a></li>
    
    <li><a href="../../post/">Posts</a></li>
    
    <li><a href="../../tags/">Tags</a></li>
    
  </ul>
</nav>

      <div>
  <h1>samtools使用</h1>
  <h3>
    17 Dec 2019
  </h3>
   <h5 id="wc">1846 Words|Read in about 4       Min|本文总阅读量<span id="busuanzi_value_page_pv"></span>次</h5>
    </h5>
  <br><br>
</div>


      <main>
        

        <blockquote>
<p>samtools是一个用于操作sam和bam文件的工具合集。sam为bam文件的十进制文件；bam为二进制文件。</p>
</blockquote>
<h1 id="view">View</h1>
<p>作用：bam与sam互转，查看bam文件，对bam进行排序和提取的操作。</p>
<ul>
<li>sam与bam互转:-S指定输入文件格式为sam，不加则为bam,-b指定输出格式(默认输出sam)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">samtools view -Sb SRR3589956.sam &gt;SRR3589956.bam <span style="color:#75715e">#重定向符也可以换成-o参数</span>
samtools view -h SRR3589956.bam &gt; SRR3589956.sam <span style="color:#75715e">#-h置输出sam时带上头注释信息</span>
</code></pre></div><ul>
<li>过滤功能-F：后接flag数字，常用有4（表示序列没比对上）、8（配对的另一条序列，即mate序列没比对上）以及12（两条序列都没比对上）。加上-F就表示过滤掉这些情况</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#提取一条reads比对到参考序列上的序列结果</span>
samtools view -bF4 abc.bam&gt;abc.F4.bam
<span style="color:#75715e">#提取两条reads都比对到参考序列上的序列结果</span>
samtools view -bF12 abc.bam&gt;abc.F12.bam
</code></pre></div><p>反之-f，就是提取指定flag的序列.当然还有其它参数，详情请&ndash;help</p>
<h1 id="sort">sort</h1>
<p>作用：对bam进行排序，一些软件需要使用排序后的bam，拿到bam先按照比对位置的顺序排一下，百利无一害。
Usage: samtools sort [-n] [-m <maxMem>] &lt;in.bam&gt; &lt;out.prefix&gt; 
-m 参数默认下是 500,000,000 即500M。每个线程运行内存大小。
-n 设定排序方式按short reads的ID排序。默认下是按序列在fasta文件中的顺序（即header）和序列从左往右的位点排序。
-@：设置排序和压缩的线程数，默认单线程
<code>samtools sort -@ 10 -o abc.sorted.bam abc.bam</code></p>
<h1 id="merge">merge</h1>
<p>作用：将两个及以上的sort过的bam文件融合成一个bam文件,融合后的文件不需要则是已经sort过了的。
Usage:   samtools merge [-nr] [-h inh.sam] &lt;out.bam&gt; &lt;in1.bam&gt; &lt;in2.bam&gt;[&hellip;]</p>
<h1 id="index">index</h1>
<p>作用：对bam文件构建索引，产生.bai文件，方便以后的快速处理；bam文件进行排序sort后，才能进行index，否则报错；要显示比对结果时，比如用IGV导入bam，就需要有.bai的存在</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">samtools index abc.bam
</code></pre></div><p><strong>当有多个bam文件时，一般思路就是对每一个bam进行sort、index后，再merge成一个整体merged.bam，然后对merged.bam再进行sort、index，才算能用了，得到最终结果应该是是sorted.merge.bam</strong></p>
<h1 id="faidx">faidx</h1>
<p>作用：对fasta文件建立提取索引，索引文件后缀是.fai。利用索引文件可以快速提取fasta文件中的某些序列</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">samtools faidx hg19.fasta
</code></pre></div><h1 id="tview">tview</h1>
<p>作用：直观显示reads比对到基因组的情况，与IGV类似需要先sort和index</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">samtools tview abc.sorted.bam hg19.fasta
</code></pre></div><h1 id="flagstat">flagstat</h1>
<p>作用：统计bam文件的比对结果</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">samtools flagstat abc.sorted.bam &gt; abc.sorted.flagstat.txt
</code></pre></div><h1 id="depth">depth</h1>
<p>作用：统计每个碱基位点的测序深度;需要使用重定向定义输出文件；要使用构建过索引的bam
Usage: bam2depth [-r reg] [-q baseQthres] [-Q mapQthres] [-b in.bed] &lt;in1.bam&gt; [&hellip;]
-r：（region）加染色体号；
-q：要求测序碱基质量最低值；
-Q：要求比对的质量最低值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">samtools depth abc.sorted.bam &gt;abc.depth
</code></pre></div><h1 id="mpileup">mpileup</h1>
<p>作用：用于生成bcf文件，或者说是pileup文件，之后结合bcftools进行SNP与InDel的分析，安装samtools时，包含了bcftools。【非常重要】
Usage: samtools mpileup [-EBug] [-C capQcoef] [-r reg] [-f in.fa] [-l list] [-M capMapQ] [-Q minBaseQ] [-q minMapQ] in.bam [in2.bam [&hellip;]]
-f：输入有索引的参考基因组fasta；
-g：输出到二进制的bcf格式【不使用-g，就不生成bcf格式，而是一个文本文件，统计了参考序列中每个碱基位点的比对情况；每一行代表参考序列中某一个碱基位点的比对结果】
-u：类似于-g，但是其主要用在管道操作，因为其输出是未压缩的bcf文件。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">samtools mpileup -f hg19.fa abc.sorted.bam &gt;abc.mpileup.txt
</code></pre></div><p>结果包含6列：参考序列名、匹配位置、参考碱基、比对上的reads数、比对的情况、比对的碱基质量</p>
<pre><code>在第5列比对具体情况中:
. 表示与参考序列正链匹配；
, 表示与参考序列负链匹配；
ATCGN 表示在正链不匹配；
atcgn 表示在负链不匹配；
* 模糊碱基；
^ 匹配的碱基是一个read的开始，后面的ASCII码-33表示比对质量，再向后修饰的(.,ATCGNatcgn) 表示该read的第一个碱基；
$ 表示一个read结束，修饰前面碱基;
正则表达式+[0-9][ATCGNatcgn] 表示在该位点后面插入的碱基；
正则表达式-[0-9][ATCGNatcgn] 表示该位点后面缺失的碱基
</code></pre><h1 id="bamfastq">bam转fastq</h1>
<p>作用：方便提取出一段比对到参考序列的reads进行分析
利用软件：http://www.hudsonalpha.org/gsl/information/software/bam2fastq</p>
<h1 id="rmdup">rmdup</h1>
<p>作用：将测序数据中由于PCR duplicate得到的reads去掉，只保留比对质量最高的reads</p>
<h1 id="idxstats">idxstats</h1>
<p>作用：输出一个表格，包含“序列名、序列长度、比对上的reads数、没有比对上的reads数”；其中第四列指PE reads中的一条read能匹配到参考基因组的染色体A，另一条read不能匹配到A上</p>
<h1 id="reheader">reheader</h1>
<p>作用：替换bam文件的头文件</p>
      </main>

      <div id="fastSearch">
   <input id="searchInput" tabindex="0">
   <ul id="searchResults">
   </ul>
</div>
<footer>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/r.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/python.min.js"></script>
  <script src ="/js/search.js"></script>
  <script src="../../js/fuse.js"></script> 
 <script src="../../js/fastsearch.js"></script>

  <script>
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  </script>
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id       ="busuanzi_value_site_pv"></span>次</span>
  <br>
  <span >
    <mark>CMD+/</mark>对网站进行搜索
  </span>
  
  
<script async src="../../js/center-image.js"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<center>
Liripo <SPAN id=span_dt_dt style="color: #0196e3;"></SPAN>
<SCRIPT language=javascript>
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("7/8/2019 00:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=Math.floor(e_hrsold);
e_minsold=(e_hrsold-hrsold)*60;
minsold=Math.floor((e_hrsold-hrsold)*60);
seconds=Math.floor((e_minsold-minsold)*60);
span_dt_dt.innerHTML=""+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
show_date_time();
</SCRIPT>
</center>
  
</footer>


    </div>
  </body>
</html>
