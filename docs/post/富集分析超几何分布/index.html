<!DOCTYPE html>
<html lang="Zh-cn">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>富集分析超几何分布 | Liripo</title>
    <link rel="shortcut icon" href="../../image/title.svg" type="image/x-icon">
  <script src="../../fontawesome-free-5.11.2-web/fontawesome-free-5.11.2-web/js/all.js" crossorigin="anonymous"></script>

  <style>
  	:root {
  		--pagecolour: #333333;
  		--maintext: #dddddd;
  		--faded: #888888;
  		--highlight: #6BB0DF;
  		--lowlight: #ba68c8;
	}
  </style>
  <link rel="stylesheet" href="../../css/et_book.css" />
  <link rel="stylesheet" href="../../css/search.css" />
  <link rel="stylesheet" href="../../css/style.css" />
  <link rel="alternate" type="application/rss+xml" href="https://liripo.github.io/index.xml" title="Liripo">
  
  <link rel="stylesheet" href="https://fonts.loli.net/css?family=Tangerine">

  
<meta name="twitter:card" content="summary">
<meta property="og:title" content="富集分析超几何分布">




</head>


  <body>
    



    <div class="main-content">
      <nav>
  <ul class="menu">
    
    <li><a href="../../">Home</a></li>
    
    <li><a href="../../about/">About</a></li>
    
    <li><a href="../../post/">Posts</a></li>
    
    <li><a href="../../tags/">Tags</a></li>
    
  </ul>
</nav>

      <div>
  <h1>富集分析超几何分布</h1>
  <h3>
    28 Mar 2020
  </h3>
   <h5 id="wc">790 Words|Read in about 2       Min|本文总阅读量<span id="busuanzi_value_page_pv"></span>次</h5>
    </h5>
  <br><br>
</div>


      <main>
        

        <p>超几何分布是统计学中的一种离散分布，它描述了由有限个物件中抽出n个物件，成功抽出指定种类的物件的个数。 也是生物信息学中常用的一种统计分布模型。我们在GO，KEGG的富集分析时就采用的是这个模型。 其数学表达式如下：
$$
p(k)=P(X=k)=\frac{\binom{M}{k}*\binom{N-M}{n-k}}{\binom{N}{n}}
$$</p>
<p>R中使用choose函数计算</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">(<span style="color:#a6e22e">choose</span>(M,k))<span style="color:#f92672">*</span>(<span style="color:#a6e22e">choose</span>(N<span style="color:#f92672">-</span>M,n<span style="color:#f92672">-</span>k))<span style="color:#f92672">/</span>(<span style="color:#a6e22e">choose</span>(N,n))
</code></pre></div><p>其中：</p>
<p>N： 总样本数</p>
<p>m： 总样本中“特定类别”的数量</p>
<p>n: 从总样本中随机抽取的数量</p>
<p>k: 抽取样本中属于“特定类别”的数量</p>
<p>但是我们做统计模型时，统计不是分布概率，而是累积概率，所以计算的p_value 值计算公式为：
$$
p = 1-\sum_{i = 0}^{k-1}\frac{\binom{M}{i}*\binom{N-M}{n-i}}{\binom{N}{n}}
$$
R函数phyper：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">phyper</span>(k<span style="color:#ae81ff">-1</span>,m, N<span style="color:#f92672">-</span>m, n,)
<span style="color:#a6e22e">phyper</span>(k<span style="color:#ae81ff">-1</span>,M, N<span style="color:#f92672">-</span>M, n, lower.tail<span style="color:#f92672">=</span>F)
</code></pre></div><h1 id="go">Go富集分析计算</h1>
<blockquote>
<p>从gprofiler官网看到背景基因集有18126个ENSG</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">N <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">18126</span>
goid <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">GO:0016491&#34;</span>
</code></pre></div><blockquote>
<p>goid在人中包含的ENSMBL基因</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">go <span style="color:#f92672">&lt;-</span> gprofiler2<span style="color:#f92672">::</span><span style="color:#a6e22e">gconvert</span>(query <span style="color:#f92672">=</span> goid,organism <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">hsapiens&#34;</span>,target <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ENSG&#34;</span>)
M <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">nrow</span>(go)
</code></pre></div><blockquote>
<p>假设查询56个基因，17个在这个go里面，那么超几何分布累积概率p(x&gt;=17)的概率应为：</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">56</span>
k <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">17</span>
p <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">phyper</span>(k <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>,M, N<span style="color:#f92672">-</span>M, n, lower.tail<span style="color:#f92672">=</span>T)
<span style="color:#75715e">## [1] 7.967889e-11</span>
</code></pre></div><p>使用二项式分布累积概率计算,二项式分布，是有放回的抽样，你可以多次抽到同一基因，这是不符合的。所以这个计算只能说是做为近似的估计值。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">sapply</span>(<span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>k<span style="color:#ae81ff">-1</span>, <span style="color:#a6e22e">function</span>(i) <span style="color:#a6e22e">choose</span>(n,i) <span style="color:#f92672">*</span> (M<span style="color:#f92672">/</span>N)^i <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>M<span style="color:#f92672">/</span>N)<span style="color:#a6e22e">^</span>(n<span style="color:#f92672">-</span>i)))
<span style="color:#75715e">## [1] 9.148204e-11</span>
</code></pre></div><p>使用$2\times2$列联表进行独立性检验</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">d <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(gene.not.interest<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(M<span style="color:#f92672">-</span>k, N<span style="color:#f92672">-</span>M<span style="color:#f92672">-</span>n<span style="color:#f92672">+</span>k), gene.in.interest<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(k, n<span style="color:#f92672">-</span>k))
<span style="color:#a6e22e">row.names</span>(d) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">In_category&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">not_in_category&#34;</span>)
<span style="color:#f92672">&gt;</span> d
                gene.not.interest gene.in.interest
In_category                   <span style="color:#ae81ff">751</span>               <span style="color:#ae81ff">17</span>
not_in_category             <span style="color:#ae81ff">17319</span>               <span style="color:#ae81ff">39</span>
</code></pre></div><p>经典的有卡方检验和fisher's exact test</p>
<blockquote>
<p>卡方检验</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">chisq.test</span>(d,)

	Pearson<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">s Chi-squared test with Yates&#39;</span> continuity correction

data<span style="color:#f92672">:</span>  d
X<span style="color:#f92672">-</span>squared <span style="color:#f92672">=</span> <span style="color:#ae81ff">88.108</span>, df <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, p<span style="color:#f92672">-</span>value <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2.2e-16</span>

Warning message<span style="color:#f92672">:</span>
In <span style="color:#a6e22e">chisq.test</span>(d, ) <span style="color:#f92672">:</span> Chi<span style="color:#f92672">-</span>squared近似算法有可能不准
</code></pre></div><p>对于２x２表来说，卡方检验通常也只能做为近似估计值，特别是当sample size或expected all count比较小的时候，计算并不准确。</p>
<blockquote>
<p>fisher's exact test,它使用的是超几何分布来计算p值,所以fisher's exact test和超几何模式计算的p-值是一样的。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">fisher.test</span>(d)

	Fisher<span style="color:#e6db74">&#39;</span><span style="color:#960050;background-color:#1e0010">s</span><span style="color:#960050;background-color:#1e0010"> </span><span style="color:#960050;background-color:#1e0010">E</span><span style="color:#960050;background-color:#1e0010">x</span><span style="color:#960050;background-color:#1e0010">a</span><span style="color:#960050;background-color:#1e0010">c</span><span style="color:#960050;background-color:#1e0010">t</span><span style="color:#960050;background-color:#1e0010"> </span><span style="color:#960050;background-color:#1e0010">T</span><span style="color:#960050;background-color:#1e0010">e</span><span style="color:#960050;background-color:#1e0010">s</span><span style="color:#960050;background-color:#1e0010">t</span><span style="color:#960050;background-color:#1e0010"> </span><span style="color:#960050;background-color:#1e0010">f</span><span style="color:#960050;background-color:#1e0010">o</span><span style="color:#960050;background-color:#1e0010">r</span><span style="color:#960050;background-color:#1e0010"> </span><span style="color:#960050;background-color:#1e0010">C</span><span style="color:#960050;background-color:#1e0010">o</span><span style="color:#960050;background-color:#1e0010">u</span><span style="color:#960050;background-color:#1e0010">n</span><span style="color:#960050;background-color:#1e0010">t</span><span style="color:#960050;background-color:#1e0010"> </span><span style="color:#960050;background-color:#1e0010">D</span><span style="color:#960050;background-color:#1e0010">a</span><span style="color:#960050;background-color:#1e0010">t</span><span style="color:#960050;background-color:#1e0010">a</span><span style="color:#960050;background-color:#1e0010"></span>

data<span style="color:#f92672">:</span>  d
p<span style="color:#f92672">-</span>value <span style="color:#f92672">=</span> <span style="color:#ae81ff">7.968e-11</span>
alternative hypothesis<span style="color:#f92672">:</span> true odds ratio is not equal to <span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">95</span> percent confidence interval<span style="color:#f92672">:</span>
 <span style="color:#ae81ff">0.05470043</span> <span style="color:#ae81ff">0.18852771</span>
sample estimates<span style="color:#f92672">:</span>
odds ratio 
<span style="color:#ae81ff">0.09951436</span> 
</code></pre></div><p>超几何分布是偏态的，所以fisher.test默认的双侧检验。而使用双侧和单侧的p值是一样的，不过会影响对置信区间的估计。</p>

      </main>

      <footer>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/r.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/python.min.js"></script>
  <script src ="/js/search.js"></script>

  <script>
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  </script>
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id       ="busuanzi_value_site_pv"></span>次</span>
  <span id="busuanzi_container_site_uv">
    本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
  
  
<script async src="../../js/center-image.js"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<center>
Liripo <SPAN id=span_dt_dt style="color: #0196e3;"></SPAN>
<SCRIPT language=javascript>
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("7/8/2019 00:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=Math.floor(e_hrsold);
e_minsold=(e_hrsold-hrsold)*60;
minsold=Math.floor((e_hrsold-hrsold)*60);
seconds=Math.floor((e_minsold-minsold)*60);
span_dt_dt.innerHTML=""+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
show_date_time();
</SCRIPT>
</center>
  
</footer>


    </div>
  </body>
</html>
